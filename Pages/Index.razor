@page "/"
@using BlazorGinRummy.GinRummyGame.Helpers;
@using BlazorGinRummy.GinRummyGame.Models;
@inject GinRummyGameService ginRummyGameService;

<PageTitle>Index</PageTitle>

<h4>@ginRummyGameService.GameStateMessage</h4>

@*<ol>
    @foreach (var card in ginRummyGameService.GetDeck())
    {
        <li>@card.ToString()</li>
    }
</ol>*@

<ol>
    @foreach (var card in ginRummyGameService.handPlayerOne)
    {
        <li>@card.FullNameString()</li>
        <img width="60" height="60" src="@($"SVG-cards/{card.FullNameString()}.svg")">
    }
</ol>

<p>@ginRummyGameService.HandToString(ginRummyGameService.handPlayerTwo)</p>
<br />
<p>Discard Pile: @ginRummyGameService.discardPile.Last().ToString()</p>
<br />
<p>@ginRummyGameService.HandToString(ginRummyGameService.handPlayerOne)</p>
<br />

<p>Player one turn</p>
<input type="number" @bind-value="@playerOneNumber" min="0" max="9">
<button @onclick="@(async () => await SubmitPlayerOneTurn())" disabled="@(!ginRummyGameService.isPlayerOneTurn)">Submit</button>



<br />

<p>@ginRummyGameService.isPlayerOneTurn</p>

<p>@playerOneNumber</p>

@code {
    private int playerOneNumber;

    private async Task SubmitPlayerOneTurn()
    {
        ginRummyGameService.PlayerChooseDiscard(true, playerOneNumber);
        StateHasChanged();

        await GetComputerTurn();
    }

    private async Task GetComputerTurn()
    {
        await Task.Delay(1000); // Delay so that user can better see what decision the computer player made.
        ginRummyGameService.PlayerChooseDiscard(false, 9);
        StateHasChanged();
    }
}



@*<ImagesTest />*@

@*<GinRummyTest />*@

                @*
@if(@ginRummyGameService.isPlayerOneTurn)
{
    <p>Player one turn</p>
    <input type="number" @bind-value="@playerOneNumber" min="0" max="9">
    <button @onclick="@SubmitPlayerOneTurn">Submit</button>

}
else
{
    /* 
    
    This is extremely hacky but this is the only method I could get to work so that delays could be 
    programmed in without blocking prior UI updates.
      
    */

    <img src="loading.jpg" @onload="@(async () => await GetComputerTurn())" hidden>
}




    //private void SubmitPlayerOneTurn()
    //{
    //    ginRummyGameService.PlayerChooseDiscard(true, playerOneNumber);
    //    StateHasChanged();
    //}



*@

